# Wifi config
The following was generated by ChatGPT and describes configuring the pi zero W for simultaneous AP and client mode.
There are a bunch of instructions on the internet to do this but they are unstable because wpa_supplicant appears to interfere with the AP configuration.

The following prompt was used:
```
Given a Raspberry Pi Zero W, which has a wifi chip supporting simultaneous AP and client connections, and has Ubuntu server installed, generate instructions to enable simultaneous AP and client wifi support. Note that there is no requirement to bridge between the two. As an engineer, I don't need explicit instructions on how to install packages or edit files etc - just describe what changes are required for what files etc. Also, (this is important) be sure to avoid wpa_supplicant interfering with the AP interface since both are likely to exist on wlan0.
```

## ChatGPT instructions

To enable simultaneous AP and client WiFi support on your Raspberry Pi Zero W with Ubuntu Core, you can follow these steps:

1. Install necessary packages:

* hostapd: for creating the access point
* dnsmasq: for providing DHCP and DNS services
* network-manager: for managing the client connection

2. Create a virtual interface for the access point:

* Edit the /etc/network/interfaces file and add the following lines:
```
auto wlan0
iface wlan0 inet dhcp
    wpa-conf /etc/wpa_supplicant/wpa_supplicant.conf

auto wlan0_ap
iface wlan0_ap inet static
    address 192.168.10.1
    netmask 255.255.255.0
```

3. Configure wpa_supplicant to avoid interfering with the AP interface:
* Create a new file /etc/wpa_supplicant/wpa_supplicant.conf with the following content:

```
ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev
update_config=1
country=<Your_Country_Code>

network={
    ssid="<Your_SSID>"
    psk="<Your_PSK>"
    key_mgmt=WPA-PSK
}
```

4. Configure hostapd for the access point:
* Create a new file /etc/hostapd/hostapd.conf with the following content:
```
interface=wlan0_ap
driver=nl80211
ssid=<AP_SSID>
hw_mode=g
channel=<AP_Channel>
ieee80211n=1
wmm_enabled=1
ht_capab=[HT40][SHORT-GI-20][DSSS_CCK-40]
macaddr_acl=0
auth_algs=1
ignore_broadcast_ssid=0
wpa=2
wpa_key_mgmt=WPA-PSK
wpa_pairwise=TKIP
rsn_pairwise=CCMP
wpa_passphrase=<AP_PSK>
```

* Edit the /etc/default/hostapd file and set the DAEMON_CONF variable:
```
DAEMON_CONF="/etc/hostapd/hostapd.conf"
```

5. Configure dnsmasq for DHCP and DNS services:
* Create a new file /etc/dnsmasq.d/access_point.conf with the following content:
```
interface=wlan0_ap
dhcp-range=192.168.10.100,192.168.10.200,255.255.255.0,24h
dhcp-option=3,192.168.10.1
dhcp-option=6,192.168.10.1
```

6. Configure NetworkManager to manage the client connection on wlan0:
* Edit the /etc/NetworkManager/NetworkManager.conf file and add the following lines:
```
[main]
plugins=keyfile

[keyfile]
unmanaged-devices=interface-name:wlan0_ap
```

7. Restart services and enable them at boot:
* Restart and enable the wpa_supplicant, hostapd, dnsmasq, and NetworkManager services.

After completing these steps, your Raspberry Pi Zero W should have simultaneous AP and client WiFi support with the AP and client interfaces isolated from each other.